<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Transformeræ¨¡å‹ | maomaoliao</title>
    <meta name="description" content="æˆ‘è‡ªå·±çš„åšå®¢">
    <meta name="generator" content="VitePress v1.3.1">
    <link rel="preload stylesheet" href="/assets/style.CRFnPRtn.css" as="style">
    
    <script type="module" src="/assets/app.moGOnyrS.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.Dra1Nefz.js">
    <link rel="modulepreload" href="/assets/chunks/theme.D0SnpXlj.js">
    <link rel="modulepreload" href="/assets/documents_artificial_NLP_Transformer.md.txWInAT4.lean.js">
    <link rel="icon" type="image/webp" href="/cat.webp">
    <meta name="author" content="liaoyan">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"dark",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-f192e0ba><!--[--><!--]--><!--[--><span tabindex="-1" data-v-58b6c871></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-58b6c871> Skip to content </a><!--]--><!----><header class="VPNav" data-v-f192e0ba data-v-d98e4ac4><div class="VPNavBar has-sidebar top" data-v-d98e4ac4 data-v-f84c687f><div class="wrapper" data-v-f84c687f><div class="container" data-v-f84c687f><div class="title" data-v-f84c687f><div class="VPNavBarTitle has-sidebar" data-v-f84c687f data-v-b151295e><a class="title" href="/" data-v-b151295e><!--[--><!--]--><!--[--><img class="VPImage logo" src="/cat.png" alt data-v-ac83d302><!--]--><span data-v-b151295e>maomaoliao</span><!--[--><!--]--></a></div></div><div class="content" data-v-f84c687f><div class="content-body" data-v-f84c687f><!--[--><!--]--><div class="VPNavBarSearch search" data-v-f84c687f><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-f84c687f data-v-64930ffd><span id="main-nav-aria-label" class="visually-hidden" data-v-64930ffd> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-64930ffd data-v-af08a8a1><!--[--><span data-v-af08a8a1>ğŸ¡ä¸»é¡µ</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-64930ffd data-v-253e969c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-253e969c><span class="text" data-v-253e969c><!----><span data-v-253e969c>ğŸ”–å‰ç«¯æŠ€æœ¯</span><span class="vpi-chevron-down text-icon" data-v-253e969c></span></span></button><div class="menu" data-v-253e969c><div class="VPMenu" data-v-253e969c data-v-49f0309e><div class="items" data-v-49f0309e><!--[--><!--[--><div class="VPMenuLink" data-v-49f0309e data-v-c77dfb72><a class="VPLink link" href="/documents/font_end/%E5%9F%8B%E7%82%B9%E7%9B%91%E6%8E%A7.html" data-v-c77dfb72><!--[-->ğŸ–¥ï¸ åŸ‹ç‚¹ç›‘æ§<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-49f0309e data-v-c77dfb72><a class="VPLink link" href="/documents/font_end/webpack%E6%89%93%E5%8C%85%E6%BA%90%E7%A0%81.html" data-v-c77dfb72><!--[-->ğŸ”¥ webpackæ‰“åŒ…æºç <!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-49f0309e data-v-c77dfb72><a class="VPLink link" href="/documents/font_end/ccid%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2.html" data-v-c77dfb72><!--[-->ğŸ“ˆ ccidè‡ªåŠ¨åŒ–éƒ¨ç½²<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-49f0309e data-v-c77dfb72><a class="VPLink link" href="/documents/font_end/pinia%E6%89%8B%E5%86%99%E6%BA%90%E7%A0%81.html" data-v-c77dfb72><!--[-->ğŸ‘Œ piniaæ‰‹å†™æºç <!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-64930ffd data-v-253e969c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-253e969c><span class="text" data-v-253e969c><!----><span data-v-253e969c>ğŸ”¥AIæŠ€æœ¯</span><span class="vpi-chevron-down text-icon" data-v-253e969c></span></span></button><div class="menu" data-v-253e969c><div class="VPMenu" data-v-253e969c data-v-49f0309e><div class="items" data-v-49f0309e><!--[--><!--[--><div class="VPMenuLink" data-v-49f0309e data-v-c77dfb72><a class="VPLink link active" href="/documents/artificial/NLP/Transformer.html" data-v-c77dfb72><!--[-->ğŸ”¥NLP<!--]--></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-49f0309e data-v-d89c80df><!----><!--[--><!--[--><div class="VPMenuLink" data-v-d89c80df data-v-c77dfb72><a class="VPLink link active" href="/documents/artificial/NLP/Transformer.html" data-v-c77dfb72><!--[-->ğŸ¤– Transformer<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuLink" data-v-49f0309e data-v-c77dfb72><a class="VPLink link" href="/documents/artificial/CNN/Yolov5%E8%87%AA%E6%88%91%E8%A7%A3%E6%9E%90.html" data-v-c77dfb72><!--[-->ğŸ”¥CNN<!--]--></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-49f0309e data-v-d89c80df><!----><!--[--><!--[--><div class="VPMenuLink" data-v-d89c80df data-v-c77dfb72><a class="VPLink link" href="/documents/artificial/CNN/Yolov5%E8%87%AA%E6%88%91%E8%A7%A3%E6%9E%90.html" data-v-c77dfb72><!--[-->ğŸŒ± Yolov5è‡ªæˆ‘è§£æ<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-f84c687f data-v-0f0a40d7><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to light theme" aria-checked="true" data-v-0f0a40d7 data-v-a8759655 data-v-92ddb6a9><span class="check" data-v-92ddb6a9><span class="icon" data-v-92ddb6a9><!--[--><span class="vpi-sun sun" data-v-a8759655></span><span class="vpi-moon moon" data-v-a8759655></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-f84c687f data-v-ffd9f3ab data-v-253e969c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-253e969c><span class="vpi-more-horizontal icon" data-v-253e969c></span></button><div class="menu" data-v-253e969c><div class="VPMenu" data-v-253e969c data-v-49f0309e><!----><!--[--><!--[--><!----><div class="group" data-v-ffd9f3ab><div class="item appearance" data-v-ffd9f3ab><p class="label" data-v-ffd9f3ab>Appearance</p><div class="appearance-action" data-v-ffd9f3ab><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to light theme" aria-checked="true" data-v-ffd9f3ab data-v-a8759655 data-v-92ddb6a9><span class="check" data-v-92ddb6a9><span class="icon" data-v-92ddb6a9><!--[--><span class="vpi-sun sun" data-v-a8759655></span><span class="vpi-moon moon" data-v-a8759655></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-f84c687f data-v-8fda79b3><span class="container" data-v-8fda79b3><span class="top" data-v-8fda79b3></span><span class="middle" data-v-8fda79b3></span><span class="bottom" data-v-8fda79b3></span></span></button></div></div></div></div><div class="divider" data-v-f84c687f><div class="divider-line" data-v-f84c687f></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-f192e0ba data-v-ee10a57b><div class="container" data-v-ee10a57b><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-ee10a57b><span class="vpi-align-left menu-icon" data-v-ee10a57b></span><span class="menu-text" data-v-ee10a57b>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-ee10a57b data-v-055e1aac><button data-v-055e1aac>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-f192e0ba data-v-000df708><div class="curtain" data-v-000df708></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-000df708><span class="visually-hidden" id="sidebar-aria-label" data-v-000df708> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-3b03ea03><section class="VPSidebarItem level-0 collapsible has-active" data-v-3b03ea03 data-v-d1074b0e><div class="item" role="button" tabindex="0" data-v-d1074b0e><div class="indicator" data-v-d1074b0e></div><h2 class="text" data-v-d1074b0e>NLP</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-d1074b0e><span class="vpi-chevron-right caret-icon" data-v-d1074b0e></span></div></div><div class="items" data-v-d1074b0e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d1074b0e data-v-d1074b0e><div class="item" data-v-d1074b0e><div class="indicator" data-v-d1074b0e></div><a class="VPLink link link" href="/documents/artificial/NLP/Transformer.html" data-v-d1074b0e><!--[--><p class="text" data-v-d1074b0e>Transformer</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-3b03ea03><section class="VPSidebarItem level-0 collapsible collapsed" data-v-3b03ea03 data-v-d1074b0e><div class="item" role="button" tabindex="0" data-v-d1074b0e><div class="indicator" data-v-d1074b0e></div><h2 class="text" data-v-d1074b0e>CNN</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-d1074b0e><span class="vpi-chevron-right caret-icon" data-v-d1074b0e></span></div></div><div class="items" data-v-d1074b0e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d1074b0e data-v-d1074b0e><div class="item" data-v-d1074b0e><div class="indicator" data-v-d1074b0e></div><a class="VPLink link link" href="/documents/artificial/CNN/Yolov5%E8%87%AA%E6%88%91%E8%A7%A3%E6%9E%90.html" data-v-d1074b0e><!--[--><p class="text" data-v-d1074b0e>Yolov5è‡ªæˆ‘è§£æ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-f192e0ba data-v-94394141><div class="VPDoc has-sidebar has-aside" data-v-94394141 data-v-d97ed5b1><!--[--><!--]--><div class="container" data-v-d97ed5b1><div class="aside" data-v-d97ed5b1><div class="aside-curtain" data-v-d97ed5b1></div><div class="aside-container" data-v-d97ed5b1><div class="aside-content" data-v-d97ed5b1><div class="VPDocAside" data-v-d97ed5b1 data-v-234cab69><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-234cab69 data-v-ab614709><div class="content" data-v-ab614709><div class="outline-marker" data-v-ab614709></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-ab614709>On this page</div><ul class="VPDocOutlineItem root" data-v-ab614709 data-v-c2482c5d><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-234cab69></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d97ed5b1><div class="content-container" data-v-d97ed5b1><!--[--><!--]--><main class="main" data-v-d97ed5b1><div style="position:relative;" class="vp-doc _documents_artificial_NLP_Transformer" data-v-d97ed5b1><div><h1 id="transformeræ¨¡å‹" tabindex="-1">Transformeræ¨¡å‹ <a class="header-anchor" href="#transformeræ¨¡å‹" aria-label="Permalink to &quot;Transformeræ¨¡å‹&quot;">â€‹</a></h1><h2 id="_1-transformeræ€»ä½“ç»“æ„" tabindex="-1">1.Transformeræ€»ä½“ç»“æ„ <a class="header-anchor" href="#_1-transformeræ€»ä½“ç»“æ„" aria-label="Permalink to &quot;1.Transformeræ€»ä½“ç»“æ„&quot;">â€‹</a></h2><p>Transformerçš„ç»“æ„å‡ºè‡ªäºã€ŠAttention is all you needã€‹ä¸­æ‰€é…çš„Transformerç»“æ„å›¾ã€‚Transformer æ¨¡å‹ä¾èµ–äºä¸¤ä¸ªç‹¬ç«‹ã€è¾ƒå°çš„æ¨¡å‹ï¼šç¼–ç å™¨å’Œè§£ç å™¨ã€‚</p><p>ç¼–ç å™¨æ¥æ”¶è¾“å…¥ï¼Œè€Œè§£ç å™¨è¾“å‡ºé¢„æµ‹ã€‚ï¼ˆè§£ç å™¨æ˜¯ç”¨æ¥åšç”Ÿæˆçš„ï¼‰ <img src="/transformer.png"></p><p class="indent-8">åœ¨ç¼–ç å™¨-è§£ç å™¨æ¶æ„å‡ºç°ä¹‹å‰ï¼Œåºåˆ—é—®é¢˜çš„é¢„æµ‹å®Œå…¨åŸºäºå¯¹è¾“å…¥åºåˆ—çš„ç´¯ç§¯è®°å¿†ï¼Œè¿™äº›è®°å¿†è¢«â€œå‹ç¼©â€ä¸ºä¸€ä¸ªéšè—çŠ¶æ€çš„è¡¨ç¤ºã€‚å°½ç®¡ LSTM å’Œ GRU ç­‰æ¶æ„è¯•å›¾æ”¹å–„é•¿ç¨‹ä¾èµ–é—®é¢˜ï¼Œä½†å®ƒä»¬å¹¶æ²¡æœ‰å®Œå…¨è§£å†³ RNN çš„æ ¹æœ¬é—®é¢˜ï¼Œå³æ— æ³•å®Œå…¨é€šè¿‡é¢„æµ‹æ¥æ‰¿è½½é•¿åºåˆ—çš„ä¿¡æ¯ã€‚</p><p class="indent-8">åœ¨ç¼–ç å™¨-è§£ç å™¨æ¶æ„ä¸­ï¼Œç¼–ç å™¨æ¥æ”¶æ•´ä¸ªè¾“å…¥åºåˆ—ã€‚å®ƒå°†å…¶è½¬æ¢ä¸ºçŸ¢é‡åŒ–è¡¨ç¤ºï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªæ—¶é—´æ­¥éª¤ä¸­è¾“å…¥åºåˆ—çš„ç´¯ç§¯è®°å¿†ã€‚ç„¶åï¼Œè¾“å…¥åºåˆ—çš„æ•´ä¸ªçŸ¢é‡åŒ–è¡¨ç¤ºè¢«è¾“å…¥åˆ°è§£ç å™¨ä¸­ï¼Œè§£ç å™¨â€œè§£ç â€ç¼–ç å™¨æ”¶é›†çš„ä¿¡æ¯å¹¶å°è¯•åšå‡ºæœ‰æ•ˆé¢„æµ‹ã€‚</p><h2 id="_2-ç¼–ç å™¨" tabindex="-1">2.ç¼–ç å™¨ <a class="header-anchor" href="#_2-ç¼–ç å™¨" aria-label="Permalink to &quot;2.ç¼–ç å™¨&quot;">â€‹</a></h2><h3 id="_2-1-ç¼–ç å™¨åŸç†" tabindex="-1">2.1 ç¼–ç å™¨åŸç† <a class="header-anchor" href="#_2-1-ç¼–ç å™¨åŸç†" aria-label="Permalink to &quot;2.1 ç¼–ç å™¨åŸç†&quot;">â€‹</a></h3><p>TransformeråƒSeq2seqä¸€æ ·çš„å½¢å¼ï¼Œå…·æœ‰Encoder-Decoderç»“æ„ã€‚</p><div class="flex justify-center"><img src="/%E7%BC%96%E7%A0%81%E5%99%A8.png"></div><p class="indent-8">ç¼–ç å™¨è´Ÿè´£å°†è¾“å…¥åºåˆ—è½¬æ¢ä¸ºæœºå™¨å¯è¯»çš„è¡¨ç¤ºï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šæ•è·å•è¯ä¹‹é—´çš„ç›¸ä¼¼æ€§åŠå…¶åœ¨åºåˆ—ä¸­çš„ç›¸å¯¹ä½ç½®ã€‚è¾“å…¥åºåˆ—é¦–å…ˆç»è¿‡è¾“å…¥åµŒå…¥å’Œä½ç½®ç¼–ç å±‚ã€‚è¿™äº›æ“ä½œæ˜¯ä¸ºäº†è¾“å…¥çš„å•è¯è½¬æ¢ä¸ºé€‚åˆç¼–ç å™¨å±‚å¤„ç†çš„å½¢å¼ã€‚</p><p>ç¼–ç å™¨å±‚ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢ç°è‰²çš„éƒ¨åˆ†ï¼‰æ˜¯ç¼–ç å™¨çš„æ ¸å¿ƒï¼Œå¤§éƒ¨åˆ†â€œé­”æ³•â€éƒ½å‘ç”Ÿåœ¨è¿™é‡Œã€‚</p><p>åœ¨åŸå§‹è®ºæ–‡ä¸­ï¼Œå»ºè®®å°†ç¼–ç å™¨å±‚çš„Nè®¾ç½®ä¸º6ï¼Œä¹Ÿå°±æ˜¯å †å å…­æ¬¡ã€‚ç¼–ç å™¨ç”±ä¸€ä¸ªå¤šå¤´æ³¨æ„åŠ›å—ç»„æˆï¼Œåé¢è·Ÿç€ä¸€ä¸ªå‰é¦ˆç¥ç»ç½‘ç»œï¼Œè¯¥ç¥ç»ç½‘ç»œåœ¨ä¸¤ä¸ªè¾“å‡ºåéƒ½æœ‰æ®‹å·®è¿æ¥å’Œå±‚è§„èŒƒåŒ–ã€‚</p><p>å¤šå¤´æ³¨æ„åŠ›æ¨¡å—èƒ½å¤Ÿå‘ç°å•è¯ä¹‹é—´çš„å¤æ‚å…³ç³»ï¼Œå¹¶ç¡®å®šæ¯ä¸ªå•è¯å¯¹è¾“å…¥åºåˆ—å«ä¹‰çš„è´¡çŒ®ã€‚è¿™ä½¿å¾—ç¼–ç å™¨èƒ½å¤Ÿåƒäººç±»ä¸€æ ·ç†è§£è¯­è¨€ã€‚</p><p>åœ¨ç¼–ç å™¨å±‚ä¹‹åï¼Œå‰é¦ˆç½‘ç»œä¼šè¿›ä¸€æ­¥è½¬æ¢è¾“å…¥åºåˆ—ï¼Œä¸ºä¸‹ä¸€ä¸ªç¼–ç å™¨å±‚åšå‡†å¤‡ã€‚ç¼–ç è¿‡ç¨‹å®Œæˆåï¼Œç¼–ç å™¨è·å¾—çš„ç´¯ç§¯çŸ¥è¯†ï¼ˆæœ€åä¸€ä¸ªç¼–ç å™¨å±‚çš„è¾“å‡ºï¼‰å°†ä¼ é€’ç»™è§£ç å™¨ï¼Œè§£ç å™¨ä¼šåˆ©ç”¨è¿™äº›çŸ¥è¯†ç”Ÿæˆæœ€ç»ˆçš„è¾“å‡ºåºåˆ—ã€‚</p><p>å› æ­¤ï¼ŒTransformerEncoderç”±ä»¥ä¸‹ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ç»„æˆï¼š</p><ul><li><p>Embeddingå±‚ï¼ˆå°†å•è¯IDåºåˆ—è½¬æ¢ä¸ºå•è¯çš„åˆ†å¸ƒè¡¨ç¤ºï¼‰</p></li><li><p>Positional Encodingå±‚</p></li><li><p>ç”±ä»»æ„Nå±‚å †å çš„TransformerEncoderBlockå±‚ï¼ŒåŒ…æ‹¬Multihead Attentionå’ŒFeedForward Networkï¼ˆæ¯å±‚éƒ½åº”ç”¨Add &amp; Normï¼‰</p></li></ul><p>2.2 ä»£ç å®ç°</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.nn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LayerNorm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¼•å…¥æ¨¡å—ä¸­çš„å…¶ä»–è‡ªå®šä¹‰ç±»</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .Embedding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Embedding</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FFN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> FFN</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .MultiHeadAttention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MultiHeadAttention</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .PositionalEncoding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AddPositionalEncoding</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TransformerEncoderLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Transformerç¼–ç å™¨å±‚çš„åˆå§‹åŒ–æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        self,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        d_model: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¨¡å‹çš„ç»´åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        d_ff: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># _feed-forwardç½‘ç»œçš„ç»´åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        heads_num: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤šå¤´æ³¨æ„åŠ›ä¸­å¤´çš„æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        dropout_rate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># dropoutç‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        layer_norm_eps: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># LayerNormçš„epsilonå€¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è°ƒç”¨åŸºç±»çš„åˆå§‹åŒ–æ–¹æ³•</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–å¤šå¤´æ³¨æ„åŠ›å±‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.multi_head_attention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MultiHeadAttention(d_model, heads_num)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–self-attentionçš„dropoutå±‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dropout_self_attention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.Dropout(dropout_rate)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–self-attentionçš„LayerNorm</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.layer_norm_self_attention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LayerNorm(d_model, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">layer_norm_eps)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–_feed-forwardç½‘ç»œ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ffn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FFN(d_model, d_ff)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–_ffnçš„dropoutå±‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dropout_ffn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.Dropout(dropout_rate)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–_ffnçš„LayerNorm</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.layer_norm_ffn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LayerNorm(d_model, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">layer_norm_eps)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å‰å‘ä¼ æ’­æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> forward</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, x: torch.Tensor, mask: torch.Tensor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; torch.Tensor:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è¿›è¡Œself-attentionæ“ä½œï¼Œå¹¶å°†ç»“æœåŠ ä¸ŠåŸå§‹è¾“å…¥x</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.layer_norm_self_attention(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.__self_attention_block(x, mask) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è¿›è¡Œ_feed-forwardæ“ä½œï¼Œå¹¶å°†ç»“æœåŠ ä¸Šself-attentionçš„ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.layer_norm_ffn(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.__feed_forward_block(x) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è‡ªå®šä¹‰çš„self-attentionå—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> __self_attention_block</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, x: torch.Tensor, mask: torch.Tensor) -&gt; torch.Tensor:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å¤šå¤´æ³¨æ„åŠ›æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.multi_head_attention(x, x, x, mask)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å¯¹å¤šå¤´æ³¨æ„åŠ›çš„ç»“æœè¿›è¡Œdropoutæ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dropout_self_attention(x)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è‡ªå®šä¹‰çš„_feed-forwardå—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> __feed_forward_block</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, x: torch.Tensor) -&gt; torch.Tensor:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # é€šè¿‡_feed-forwardç½‘ç»œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dropout_ffn(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ffn(x))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TransformerEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Transformerç¼–ç å™¨çš„åˆå§‹åŒ–æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        self,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vocab_size: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¯æ±‡è¡¨çš„å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        max_len: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¾“å…¥åºåˆ—çš„æœ€å¤§é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pad_idx: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># paddingçš„ç´¢å¼•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        d_model: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¨¡å‹çš„ç»´åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¼–ç å™¨å±‚çš„æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        d_ff: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># _feed-forwardç½‘ç»œçš„ç»´åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        heads_num: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤šå¤´æ³¨æ„åŠ›ä¸­å¤´çš„æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        dropout_rate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># dropoutç‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        layer_norm_eps: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># LayerNormçš„epsilonå€¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        device: torch.device </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.device(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cpu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŒ‡å®šè®¾å¤‡ï¼Œé»˜è®¤ä¸ºCPU</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è°ƒç”¨åŸºç±»çš„åˆå§‹åŒ–æ–¹æ³•</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–è¯åµŒå…¥å±‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.embedding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Embedding(vocab_size, d_model, pad_idx)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–ä½ç½®ç¼–ç å±‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.positional_encoding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AddPositionalEncoding(d_model, max_len, device)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–Transformerç¼–ç å™¨å±‚çš„åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        encodelayerList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [TransformerEncoderLayer(d_model, d_ff, heads_num, dropout_rate, layer_norm_eps) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(N)] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºNå±‚ç¼–ç å™¨å±‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.encoder_layers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.ModuleList(encodelayerList)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ç¼–ç å™¨çš„å‰å‘ä¼ æ’­æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> forward</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, x: torch.Tensor, mask: torch.Tensor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; torch.Tensor:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å°†è¾“å…¥xé€šè¿‡è¯åµŒå…¥å±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.embedding(x)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å°†ä½ç½®ç¼–ç åŠ åˆ°è¯åµŒå…¥çš„ç»“æœä¸Š</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.positional_encoding(x)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # éå†æ‰€æœ‰ç¼–ç å™¨å±‚ï¼Œå¹¶è¿›è¡Œå‰å‘ä¼ æ’­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> encoder_layer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.encoder_layers:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> encoder_layer(x, mask)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x</span></span></code></pre></div><h2 id="_3-è§£ç å™¨" tabindex="-1">3.è§£ç å™¨ <a class="header-anchor" href="#_3-è§£ç å™¨" aria-label="Permalink to &quot;3.è§£ç å™¨&quot;">â€‹</a></h2><h3 id="_3-1-è§£ç å™¨åŸç†" tabindex="-1">3.1 è§£ç å™¨åŸç† <a class="header-anchor" href="#_3-1-è§£ç å™¨åŸç†" aria-label="Permalink to &quot;3.1 è§£ç å™¨åŸç†&quot;">â€‹</a></h3><p>è§£ç å™¨æ¥æ”¶ç¼–ç å™¨çš„è¾“å‡ºï¼Œè¿™æ˜¯ç¼–ç å™¨å·²ç»ç†è§£å¥½äº†çš„çŸ¥è¯†ã€‚</p><p>åœ¨ç¬¬ä¸€ä¸ªé¢„æµ‹æ—¶é—´æ­¥ï¼Œè§£ç å™¨è®¾ç½®â€œå¥å­å¼€å¤´â€æ ‡è®°ï¼Œè¿™æœ‰åŠ©äºè§£ç å™¨ç†è§£è¾“å…¥çš„æ–‡æœ¬æ˜¯ä¸€ä¸ªæ–°çš„å¥å­ã€‚</p><p>è§£ç å™¨æ ¹æ®å·²æœ‰çš„é¢„æµ‹çŸ¥è¯†è¿›è¡Œåˆ†æï¼Œå¾—å‡ºåˆæ­¥çš„è§è§£ã€‚ç„¶åï¼Œè§£ç å™¨å°†è¿™äº›åˆæ­¥çš„è§è§£ä¸ç¼–ç å™¨çš„è¾“å‡ºç›¸ç»“åˆï¼Œè¿›è¡Œæ›´æ·±å…¥çš„å¤„ç†å’Œåˆ†æã€‚æœ€åï¼Œè§£ç å™¨è¾“å‡ºä¸‹ä¸€ä¸ªæ—¶é—´æ­¥éª¤çš„é¢„æµ‹ï¼Œå³æ‰€é€‰å•è¯æˆä¸ºè¾“å‡ºåºåˆ—ä¸­ä¸‹ä¸€ä¸ªå•è¯çš„æ¦‚ç‡ã€‚</p><div class="flex justify-center"><img src="/%E8%A7%A3%E7%A0%81%E5%99%A8.png"></div><p>Decoderä¸Encoderä¸€æ ·ï¼Œç”±Embeddingã€Positional Encodingã€Multihead Attentionã€FeedForward Networkç»„æˆã€‚</p><div class="flex justify-center"><img src="/%E8%A7%A3%E7%A0%81%E5%99%A81.png"></div><h3 id="_3-2-ä»£ç å®ç°" tabindex="-1">3.2 ä»£ç å®ç° <a class="header-anchor" href="#_3-2-ä»£ç å®ç°" aria-label="Permalink to &quot;3.2 ä»£ç å®ç°&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.nn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LayerNorm</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¼•å…¥æ¨¡å—ä¸­çš„å…¶ä»–è‡ªå®šä¹‰ç±»</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .Embedding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Embedding</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FFN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> FFN</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .MultiHeadAttention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MultiHeadAttention</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .PositionalEncoding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AddPositionalEncoding</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TransformerDecoderLayer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Transformerè§£ç å™¨å±‚çš„åˆå§‹åŒ–æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        self,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        d_model: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¨¡å‹çš„ç»´åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        d_ff: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é¦ˆå‰ç½‘ç»œï¼ˆFeed-Forward Networkï¼‰çš„ç»´åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        heads_num: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤šå¤´æ³¨æ„åŠ›ä¸­å¤´çš„æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        dropout_rate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># dropoutç‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        layer_norm_eps: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># LayerNormçš„epsilonå€¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è°ƒç”¨åŸºç±»çš„åˆå§‹åŒ–æ–¹æ³•</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–ç›®æ ‡è‡ªèº«çš„å¤šå¤´æ³¨æ„åŠ›å±‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.self_attention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MultiHeadAttention(d_model, heads_num)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–ç›®æ ‡è‡ªèº«æ³¨æ„åŠ›çš„dropoutå±‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dropout_self_attention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.Dropout(dropout_rate)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–ç›®æ ‡è‡ªèº«æ³¨æ„åŠ›çš„LayerNorm</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.layer_norm_self_attention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LayerNorm(d_model, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">layer_norm_eps)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–æº-ç›®æ ‡çš„å¤šå¤´æ³¨æ„åŠ›å±‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.src_tgt_attention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MultiHeadAttention(d_model, heads_num)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–æº-ç›®æ ‡æ³¨æ„åŠ›çš„dropoutå±‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dropout_src_tgt_attention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.Dropout(dropout_rate)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–æº-ç›®æ ‡æ³¨æ„åŠ›çš„LayerNorm</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.layer_norm_src_tgt_attention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LayerNorm(d_model, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">layer_norm_eps)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–é¦ˆå‰ç½‘ç»œ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ffn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FFN(d_model, d_ff)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–é¦ˆå‰ç½‘ç»œçš„dropoutå±‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dropout_ffn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.Dropout(dropout_rate)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–é¦ˆå‰ç½‘ç»œçš„LayerNorm</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.layer_norm_ffn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LayerNorm(d_model, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">eps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">layer_norm_eps)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è§£ç å™¨å±‚çš„å‰å‘ä¼ æ’­æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> forward</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        self,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tgt: torch.Tensor,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è§£ç å™¨çš„è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        src: torch.Tensor,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¼–ç å™¨çš„è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mask_src_tgt: torch.Tensor,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æº-ç›®æ ‡æ³¨æ„åŠ›çš„æ©ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mask_self: torch.Tensor,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç›®æ ‡è‡ªèº«æ³¨æ„åŠ›çš„æ©ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) -&gt; torch.Tensor:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ç›®æ ‡è‡ªèº«æ³¨æ„åŠ›æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tgt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.layer_norm_self_attention(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            tgt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.__self_attention_block(tgt, mask_self)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æº-ç›®æ ‡æ³¨æ„åŠ›æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.layer_norm_src_tgt_attention(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            tgt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.__src_tgt_attention_block(src, tgt, mask_src_tgt)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # é¦ˆå‰ç½‘ç»œæ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.layer_norm_ffn(x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.__feed_forward_block(x))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è‡ªå®šä¹‰çš„æº-ç›®æ ‡æ³¨æ„åŠ›å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> __src_tgt_attention_block</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        self, src: torch.Tensor, tgt: torch.Tensor, mask: torch.Tensor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) -&gt; torch.Tensor:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æº-ç›®æ ‡æ³¨æ„åŠ›æ“ä½œï¼Œä½¿ç”¨ç¼–ç å™¨çš„è¾“å‡ºä½œä¸ºé”®å’Œå€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dropout_src_tgt_attention(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.src_tgt_attention(tgt, src, src, mask)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è‡ªå®šä¹‰çš„ç›®æ ‡è‡ªèº«æ³¨æ„åŠ›å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> __self_attention_block</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        self, x: torch.Tensor, mask: torch.Tensor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) -&gt; torch.Tensor:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ç›®æ ‡è‡ªèº«æ³¨æ„åŠ›æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dropout_self_attention(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.self_attention(x, x, x, mask))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è‡ªå®šä¹‰çš„é¦ˆå‰ç½‘ç»œå—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> __feed_forward_block</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, x: torch.Tensor) -&gt; torch.Tensor:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # é¦ˆå‰ç½‘ç»œæ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dropout_ffn(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ffn(x))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TransformerDecoder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Transformerè§£ç å™¨çš„åˆå§‹åŒ–æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        self,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tgt_vocab_size: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç›®æ ‡è¯æ±‡è¡¨çš„å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        max_len: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¾“å…¥åºåˆ—çš„æœ€å¤§é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pad_idx: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¡«å……ç´¢å¼•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        d_model: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¨¡å‹çš„ç»´åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        N: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è§£ç å™¨å±‚çš„æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        d_ff: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é¦ˆå‰ç½‘ç»œçš„ç»´åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        heads_num: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤šå¤´æ³¨æ„åŠ›ä¸­å¤´çš„æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        dropout_rate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># dropoutç‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        layer_norm_eps: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># LayerNormçš„epsilonå€¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        device: torch.device </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.device(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cpu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŒ‡å®šè®¾å¤‡ï¼Œé»˜è®¤ä¸ºCPU</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è°ƒç”¨åŸºç±»çš„åˆå§‹åŒ–æ–¹æ³•</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–è¯åµŒå…¥å±‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.embedding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Embedding(tgt_vocab_size, d_model, pad_idx)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–ä½ç½®ç¼–ç å±‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.positional_encoding </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AddPositionalEncoding(d_model, max_len, device)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆå§‹åŒ–è§£ç å™¨å±‚çš„åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        decodeLayerList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                TransformerDecoderLayer(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    d_model, d_ff, heads_num, dropout_rate, layer_norm_eps</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(N)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºNå±‚è§£ç å™¨å±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.decoder_layers </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.ModuleList(decodeLayerList)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è§£ç å™¨çš„å‰å‘ä¼ æ’­æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> forward</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        self,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tgt: torch.Tensor,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è§£ç å™¨çš„è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        src: torch.Tensor,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¼–ç å™¨çš„è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mask_src_tgt: torch.Tensor,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æº-ç›®æ ‡æ³¨æ„åŠ›çš„æ©ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mask_self: torch.Tensor,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç›®æ ‡è‡ªèº«æ³¨æ„åŠ›çš„æ©ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) -&gt; torch.Tensor:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å°†è§£ç å™¨çš„è¾“å…¥tgté€šè¿‡è¯åµŒå…¥å±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tgt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.embedding(tgt)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å°†ä½ç½®ç¼–ç åŠ åˆ°è¯åµŒå…¥çš„ç»“æœä¸Š</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tgt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.positional_encoding(tgt)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # éå†æ‰€æœ‰è§£ç å™¨å±‚ï¼Œå¹¶è¿›è¡Œå‰å‘ä¼ æ’­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> decoder_layer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.decoder_layers:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            tgt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> decoder_layer(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                tgt,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                src,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                mask_src_tgt,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                mask_self,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tgt</span></span></code></pre></div><h2 id="_4-æ³¨æ„åŠ›æœºåˆ¶" tabindex="-1">4.æ³¨æ„åŠ›æœºåˆ¶ <a class="header-anchor" href="#_4-æ³¨æ„åŠ›æœºåˆ¶" aria-label="Permalink to &quot;4.æ³¨æ„åŠ›æœºåˆ¶&quot;">â€‹</a></h2><h3 id="_4-1-æ³¨æ„åŠ›æœºåˆ¶åŸç†" tabindex="-1">4.1 æ³¨æ„åŠ›æœºåˆ¶åŸç† <a class="header-anchor" href="#_4-1-æ³¨æ„åŠ›æœºåˆ¶åŸç†" aria-label="Permalink to &quot;4.1 æ³¨æ„åŠ›æœºåˆ¶åŸç†&quot;">â€‹</a></h3><p>æ³¨æ„åŠ›æˆ–å…¨å±€æ³¨æ„åŠ›é€šå¸¸æ˜¯è‡ªç„¶è¯­è¨€å¤„ç†æ¨¡å‹å–å¾—æˆåŠŸçš„æœ€é‡è¦å› ç´ ä¹‹ä¸€ã€‚</p><p>æ³¨æ„åŠ›çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šæ¨¡å‹å¯ä»¥æ ¹æ®è¾“å…¥è¯ä¸ä¸Šä¸‹æ–‡çš„ç›¸å…³æ€§ï¼Œæ›´å…³æ³¨æŸäº›è¾“å…¥è¯ã€‚æ¢å¥è¯è¯´ï¼Œæ¨¡å‹ä¸ºæ¯ä¸ªè¾“å…¥è¯åˆ†é…ä¸åŒç¨‹åº¦çš„â€œæ³¨æ„åŠ›â€ï¼Œè¶Šé‡è¦çš„è¯è·å¾—çš„å…³æ³¨è¶Šå¤šã€‚</p><p>æ¯”å¦‚åœ¨â€œæˆ‘çš„ç‹—æœ‰é»‘è‰²ã€åšåšçš„çš®æ¯›ï¼Œæ€§æ ¼æ´»æ³¼ã€‚æˆ‘è¿˜æœ‰ä¸€åªæ£•è‰²çš®æ¯›çš„çŒ«ã€‚æˆ‘çš„ç‹—æ˜¯ä»€ä¹ˆå“ç§çš„ï¼Ÿâ€è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ²¡æœ‰æ³¨æ„åŠ›æ¨¡å‹ä¼šåŒç­‰å¯¹å¾…çŒ«å’Œç‹—ä¿¡æ¯ï¼Œå¯èƒ½å¯¼è‡´é”™è¯¯ç­”æ¡ˆï¼Œè€Œæœ‰æ³¨æ„åŠ›ï¼Œè®­ç»ƒåçš„è¯­è¨€æ¨¡å‹ä¼šå‡å°‘å¯¹â€œæ£•è‰²çš®æ¯›â€çš„å…³æ³¨ï¼Œå› å…¶ä¸é—®é¢˜æ— å…³ï¼Œè¿™ç§æœ‰é€‰æ‹©å…³æ³¨é‡è¦å•è¯çš„èƒ½åŠ›æœ‰åŠ©äºæé«˜è‡ªç„¶è¯­è¨€å¤„ç†æ¨¡å‹æ€§èƒ½ã€‚</p><p>è‡ªæ³¨æ„åŠ›æœºåˆ¶ç±»ä¼¼äºæœç´¢å¼•æ“ï¼ŒæŸ¥è¯¢å°±åƒæ‚¨åœ¨æœç´¢æ ä¸­è¾“å…¥çš„æœç´¢æŸ¥è¯¢ï¼ŒKé”®å°±åƒæ•°æ®åº“ä¸­ç½‘ç«™çš„æ ‡é¢˜ï¼ŒVå€¼å°±åƒç½‘ç«™æœ¬èº«ã€‚å½“æ‚¨è¾“å…¥æœç´¢æŸ¥è¯¢æ—¶ï¼Œç³»ç»Ÿä¼šå°†å…¶ä¸æ•°æ®åº“ä¸­çš„é”®è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶æ ¹æ®é”®ä¸æŸ¥è¯¢çš„ç›¸ä¼¼ç¨‹åº¦å¯¹å€¼è¿›è¡Œæ’åã€‚</p><p>ç†è§£è‡ªæ³¨æ„åŠ›å¦‚ä½•åˆ†é… æ³¨æ„åŠ›å€¼ ä¸€ä¸ªæœ‰ç”¨æ–¹æ³•ï¼šå°†è¾“å…¥åºåˆ—çš„æ¯ä¸ªå…ƒç´ ä¸åºåˆ—ä¸­çš„å…¶ä»–å…ƒç´ è¿›è¡Œæ¯”è¾ƒæ¥æ„å»ºç›¸å…³çŸ©é˜µã€‚</p><img src="/Attention1.png"><p>è‡ªæ³¨æ„åŠ›æœºåˆ¶ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šQæŸ¥è¯¢ã€Ké”®å’ŒVå€¼ã€‚æ¯ä¸ªå•è¯çš„å‘é‡åŒ–è¡¨ç¤ºè¢«æŠ•å½±åˆ°ä¸‰ä¸ªè¾ƒå°çš„å‘é‡ä¸­ï¼Œåˆ†åˆ«è¡¨ç¤ºå•è¯çš„QæŸ¥è¯¢ã€Ké”®å’ŒVå€¼ã€‚</p><img src="/Attention2.png"><h3 id="_4-2-æ³¨æ„åŠ›æœºåˆ¶èƒŒåçš„æ•°å­¦åŸç†" tabindex="-1">4.2 æ³¨æ„åŠ›æœºåˆ¶èƒŒåçš„æ•°å­¦åŸç† <a class="header-anchor" href="#_4-2-æ³¨æ„åŠ›æœºåˆ¶èƒŒåçš„æ•°å­¦åŸç†" aria-label="Permalink to &quot;4.2 æ³¨æ„åŠ›æœºåˆ¶èƒŒåçš„æ•°å­¦åŸç†&quot;">â€‹</a></h3><p>å›æƒ³ä¸€ä¸‹ï¼Œä½ç½®ç¼–ç çš„è¾“å‡ºå½¢çŠ¶ä¸º (åºåˆ—é•¿åº¦)ï¼Œå…¶ä¸­ dmodel å¯ä»¥è§£é‡Šä¸ºåµŒå…¥ç»´åº¦ã€‚æ­¤çŸ©é˜µæ˜¯ç¼–ç å™¨å±‚çš„è¾“å…¥ã€‚å¯¹äºç¬¬ä¸€ä¸ªç¼–ç å™¨å±‚ä¹‹åçš„ç¼–ç å™¨å±‚ï¼Œå®ƒä»¬çš„è¾“å…¥å°†æ˜¯å‰ä¸€ä¸ªç¼–ç å™¨å±‚çš„è¾“å‡ºã€‚</p><p>è¾“å…¥çŸ©é˜µé€šè¿‡ä¸‰ä¸ªå•ç‹¬çš„æƒé‡çŸ©é˜µçº¿æ€§æŠ•å½±åˆ°ä¸‰ä¸ªè¾ƒå°çš„çŸ©é˜µä¸­ï¼Œå³ QæŸ¥è¯¢ã€Ké”® å’Œ Vå€¼ã€‚</p><p>è¿™äº›çŸ©é˜µçš„å½¢çŠ¶ä¸ºï¼ˆåºåˆ—é•¿åº¦ï¼š64ï¼‰ï¼Œå…¶ä¸­ç»´åº¦ 64 æ˜¯è®ºæ–‡ä½œè€…é€‰æ‹©çš„ä»»æ„å€¼ã€‚</p><img src="/Attention3.png"><p>QæŸ¥è¯¢ã€Ké”®å’ŒVå€¼çš„æƒé‡çŸ©é˜µåˆ†åˆ«å’Œè¿™äº›æƒé‡çŸ©é˜µä¸æ•´ä¸ªæ¨¡å‹ä¸€èµ·é€šè¿‡åå‘ä¼ æ’­è¿›è¡Œè®­ç»ƒã€‚ä¸ºçŸ©é˜µç»´åº¦é€‰æ‹©çš„å€¼ 64 ä¸ä¼šå½±å“è‡ªæ³¨æ„åŠ›çš„è®¡ç®—ã€‚</p><img src="/Attention4.png"><p>åœ¨Transformerä¸­ï¼Œé‡‡ç”¨äº†ä¸€ç§ç§°ä¸ºScaledDotProductAttentionçš„æ–¹æ³•æ¥è®¡ç®—æ³¨æ„åŠ›æƒé‡ï¼Œè¯¥æ–¹æ³•é€šè¿‡è®¡ç®—æŸ¥è¯¢Qå’Œè¾“å…¥kçš„ç‚¹ç§¯æ¥è®¡ç®— æ³¨æ„åŠ›æƒé‡ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ã€‚</p><h2 id="_5-ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›-scaled-dot-product-attention" tabindex="-1">5.ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›(Scaled Dot-Product Attention) <a class="header-anchor" href="#_5-ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›-scaled-dot-product-attention" aria-label="Permalink to &quot;5.ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›(Scaled Dot-Product Attention)&quot;">â€‹</a></h2><h3 id="_5-1-ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›åŸç†" tabindex="-1">5.1 ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›åŸç† <a class="header-anchor" href="#_5-1-ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›åŸç†" aria-label="Permalink to &quot;5.1 ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›åŸç†&quot;">â€‹</a></h3><p>Transformer é‡‡ç”¨ä¸€ç§åä¸ºâ€œScaled Dot-Product Attentionï¼ˆç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ï¼‰â€ çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶ã€‚å…¨å±€æ³¨æ„åŠ›è€ƒè™‘æ¯ä¸ªå•è¯ç›¸å¯¹äºæ•´ä¸ªè¾“å…¥åºåˆ—çš„é‡è¦æ€§ï¼Œè€Œè‡ªæ³¨æ„åŠ›åˆ™è§£è¯»åºåˆ—ä¸­å•è¯ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨â€œæˆ‘å»å•†åº—ä¹°äº†å¾ˆå¤šæ°´æœå’Œä¸€äº›å®¶å…·ã€‚å®ƒä»¬çš„å‘³é“å¾ˆæ£’â€è¿™å¥è¯ä¸­ï¼Œäººç±»è¯»è€…ä¼šæ¨æ–­â€œä»–ä»¬â€æŒ‡çš„æ˜¯æ°´æœï¼Œè€Œä¸æ˜¯å®¶å…·ã€‚ä½¿ç”¨å…¨å±€æ³¨æ„åŠ›çš„æ¨¡å‹å¯èƒ½ä¼šä¸ºâ€œæ°´æœâ€ã€â€œå®¶å…·â€å’Œâ€œå¾ˆæ£’â€åˆ†é…æ›´é«˜çš„æ³¨æ„åŠ›å€¼ï¼Œè€Œæ— éœ€ç†è§£è¿™äº›è¯ä¹‹é—´çš„å…³ç³»ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œè‡ªæ³¨æ„åŠ›å°†è¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸ªå•è¯ä¸å…¶ä»–æ¯ä¸ªå•è¯è¿›è¡Œæ¯”è¾ƒï¼Œèƒ½å¤Ÿå‘ç°â€œä»–ä»¬â€çš„æœ¬æ„ã€‚</p><p>QæŸ¥è¯¢çŸ©é˜µ å¯¹åº”çš„æ˜¯ QæŸ¥è¯¢ ä¸­å•è¯çš„çŸ¢é‡åŒ–è¡¨ç¤ºï¼ŒKé”®çŸ©é˜µ å¯¹åº”çš„æ˜¯ Ké”® ä¸­å•è¯çš„çŸ¢é‡åŒ–è¡¨ç¤ºï¼Œæ‰€ä»¥ï¼š Q X K = æƒé‡çŸ©é˜µ å³å¦‚ä¸‹å›¾ï¼š</p><img src="/Attention5.png"><p>äºŒç»´ç©ºé—´ä¸­ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„ç‚¹ç§¯å¯ä»¥çœ‹ä½œæ˜¯å‘é‡ä¹‹é—´ä½™å¼¦ç›¸ä¼¼åº¦çš„åº¦é‡ï¼Œç”±å…¶é‡çº§çš„ä¹˜ç§¯ç¼©æ”¾ã€‚</p><p>æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªå¥å­ï¼šâ€œä¸€ä¸ªç”·äººèµ°åœ¨ç¹å¿™çš„é“è·¯ä¸Šï¼Œæ‰‹é‡Œæ‹¿ç€ä»–åˆšä¹°çš„å‡ æœ¬ä¹¦ã€‚â€</p><p>æˆ‘ä»¬æƒ³è¦ç†è§£è¿™ä¸ªå¥å­ä¸­å“ªäº›è¯å¯¹äºç†è§£å¥å­çš„æ•´ä½“å«ä¹‰æ˜¯æœ€é‡è¦çš„ã€‚</p><ul><li><p>1.è¯å‘é‡è¡¨ç¤ºï¼šå°†å¥å­ä¸­çš„æ¯ä¸ªè¯è½¬æ¢æˆä¸€ä¸ªå‘é‡ã€‚åœ¨è¿™ä¸ªç®€åŒ–çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æ¯ä¸ªè¯çš„å‘é‡æ˜¯äºŒç»´çš„ã€‚</p></li><li><p>2.é€‰æ‹©æŸ¥è¯¢è¯ï¼šæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªè¯ä½œä¸ºâ€œæŸ¥è¯¢â€ï¼ˆQï¼‰ï¼Œæ¯”å¦‚â€œç”·äººâ€ï¼Œæˆ‘ä»¬æƒ³è¦çŸ¥é“è¿™ä¸ªè¯åœ¨å¥å­ä¸­ä¸å…¶ä»–è¯çš„å…³ç³»ã€‚</p></li><li><p>3.è®¡ç®—ç›¸ä¼¼åº¦ï¼šå°†â€œç”·äººâ€çš„å‘é‡ä¸å¥å­ä¸­å…¶ä»–è¯çš„å‘é‡ï¼ˆè¿™é‡Œæˆ‘ä»¬æŠŠå®ƒä»¬å½“ä½œâ€œé”®â€Kï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œæ¯”å¦‚â€œä¹¦â€å’Œâ€œé“è·¯â€ã€‚é€šè¿‡è®¡ç®—å‘é‡é—´çš„ç‚¹ç§¯æ¥è¯„ä¼°å®ƒä»¬ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚</p></li><li><p>4.åº”ç”¨æ³¨æ„åŠ›æƒé‡ï¼šæ ¹æ®ç‚¹ç§¯çš„ç»“æœï¼Œæˆ‘ä»¬ç»™æ¯ä¸ªè¯åˆ†é…ä¸€ä¸ªæƒé‡ã€‚å¦‚æœâ€œç”·äººâ€å’Œâ€œä¹¦â€çš„ç‚¹ç§¯å¾ˆé«˜ï¼Œæ„å‘³ç€å®ƒä»¬ä¹‹é—´æœ‰å¾ˆå¼ºçš„å…³è”ï¼Œå› æ­¤â€œä¹¦â€ä¼šå¾—åˆ°ä¸€ä¸ªè¾ƒå¤§çš„æƒé‡ã€‚</p></li><li><p>5.ç®€åŒ–å†³ç­–ï¼šåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç®€åŒ–äº†å†³ç­–è¿‡ç¨‹ï¼Œè®¤ä¸ºâ€œç”·äººâ€å’Œâ€œä¹¦â€ä¹‹é—´çš„å…³ç³»æ¯”â€œç”·äººâ€å’Œâ€œé“è·¯â€ä¹‹é—´çš„å…³ç³»æ›´é‡è¦ï¼Œå› ä¸ºâ€œä¹¦â€ç›´æ¥æè¿°äº†â€œç”·äººâ€çš„è¡Œä¸ºã€‚</p></li><li><p>6.æœ€ç»ˆè¾“å‡ºï¼šé€šè¿‡åŠ æƒè¿™äº›å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªç»¼åˆçš„è¡¨ç¤ºï¼Œè¿™ä¸ªè¡¨ç¤ºå¼ºè°ƒäº†â€œç”·äººâ€å’Œâ€œä¹¦â€ä¹‹é—´çš„å…³ç³»ï¼Œè€Œå¯¹â€œç”·äººâ€å’Œâ€œé“è·¯â€çš„å…³ç³»ç»™äºˆè¾ƒå°‘çš„é‡è§†ã€‚</p></li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ³¨æ„åŠ›æœºåˆ¶å¸®åŠ©æˆ‘ä»¬è¯†åˆ«å’Œå¼ºè°ƒå¥å­ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå¿½ç•¥é‚£äº›å¯èƒ½ä¸é‚£ä¹ˆå…³é”®çš„ä¿¡æ¯ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬é›†ä¸­å…³æ³¨â€œç”·äººâ€å’Œâ€œä¹¦â€ï¼Œå› ä¸ºå®ƒä»¬å¯¹äºç†è§£å¥å­å¯èƒ½æ›´ä¸ºé‡è¦ã€‚</p><img src="/Attention6.png"><p>ç”± QæŸ¥è¯¢ å’Œ Ké”® çŸ©é˜µçš„ç‚¹ç§¯ç”Ÿæˆçš„ æ³¨æ„åŠ›æƒé‡çŸ©é˜µ å…·æœ‰ (åºåˆ—é•¿åº¦ï¼Œåºåˆ—é•¿åº¦) çš„å½¢çŠ¶ã€‚</p><p>æ³¨æ„åŠ›æƒé‡çŸ©é˜µ ä¸­çš„æ¯ä¸ªå€¼éƒ½é™¤ä»¥ Ké”®ã€QæŸ¥è¯¢ å’Œ Vå€¼ çŸ©é˜µå¤§å°çš„å¹³æ–¹æ ¹ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º 8ï¼‰ã€‚</p><p>æ­¤æ­¥éª¤ç”¨äºåœ¨è®­ç»ƒæœŸé—´ç¨³å®šæ¢¯åº¦ã€‚ç„¶åï¼Œæ³¨æ„åŠ›æƒé‡çŸ©é˜µ é€šè¿‡ softmax å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†å…¶å€¼æ ‡å‡†åŒ–ä¸º 0 åˆ° 1 ä¹‹é—´ï¼Œå¹¶ç¡®ä¿çŸ©é˜µä¸­æ¯è¡Œçš„å€¼æ€»å’Œä¸º 1ã€‚</p><p>å¦‚å‰æ‰€è¿°ï¼Œä½¿ç”¨ æ³¨æ„åŠ›å€¼ å’Œ å€¼ å‘é‡è¿›è¡ŒåŠ æƒæ±‚å’Œã€‚å°†æ³¨æ„åŠ›å¾—åˆ†å½’ä¸€åŒ–ä¸ºæ€»å’Œä¸º 1 ä½¿å¾—è¿™ç§åŠ æƒæ±‚å’Œè¿ç®—æˆä¸ºå¯èƒ½ã€‚</p><p>æœ€åï¼Œå°†å½’ä¸€åŒ–çš„ æ³¨æ„åŠ›æƒé‡çŸ©é˜µ ä¸ å€¼çŸ©é˜µ ç›¸åŠ ï¼Œå¾—åˆ°ä¸€ä¸ªå¤§å°ä¸º (åºåˆ—é•¿åº¦ï¼Œ64) çš„çŸ©é˜µï¼Œè¯¥çŸ©é˜µå¯ä»¥çœ‹ä½œæ˜¯å¸¦æœ‰æ³¨æ„åŠ›ä¿¡æ¯çš„è¾“å…¥åºåˆ—çš„è¾ƒå°çŸ¢é‡åŒ–è¡¨ç¤ºã€‚</p><p>è¾“å‡ºçŸ©é˜µçš„ç¬¬ä¸€è¡Œæ˜¯Vå€¼çŸ©é˜µä¸­è¡Œå‘é‡çš„åŠ æƒå’Œï¼Œæƒé‡æ˜¯è¾“å…¥åºåˆ—ä¸­ç¬¬ä¸€ä¸ªè¯å¯¹æ‰€æœ‰å…¶ä»–è¯çš„æ³¨æ„åŠ›å€¼ã€‚</p><img src="/Attention7.png"><p>è¯·æ³¨æ„ï¼Œè¾“å‡ºçŸ©é˜µçš„å¤§å°ä¸º (åºåˆ—é•¿åº¦ï¼Œ64) è€Œä¸æ˜¯ (åºåˆ—é•¿åº¦ï¼Œ512)ã€‚</p><p>é‡ç‚¹è¦è®°ä½ï¼Œè¾“å‡ºçŸ©é˜µçš„å¤§å°åº”ä¸åŸå§‹è¯åµŒå…¥ç›¸åŒï¼Œå› ä¸ºå®ƒå°†ç”¨ä½œä¸‹ä¸€ä¸ªç¼–ç å™¨å±‚çš„è¾“å…¥ï¼Œåœ¨ç¬¬ä¸€ä¸ªç¼–ç å±‚çš„æƒ…å†µä¸‹ï¼Œè¯¥ç¼–ç å™¨å±‚éœ€è¦å°†è¯åµŒå…¥ä½œä¸ºè¾“å…¥ã€‚</p><p>åœ¨Transformerä¸­ä½¿ç”¨çš„ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›æƒé‡è®¡ç®—ï¼Œå¯ä»¥ä½¿ç”¨æŸ¥è¯¢ å’Œè¾“å…¥ ä»¥ä¸‹çš„å…¬å¼è¡¨ç¤ºã€‚</p><img src="/Attention8.png"><p>åœ¨å¤„ç†é—®ç­”æˆ–æœºå™¨ç¿»è¯‘ç­‰ä»»åŠ¡æ—¶ï¼Œä½¿ç”¨Transformeræ¨¡å‹ï¼Œä¸Šè¿°å…¬å¼ä¸­çš„ å’Œ åˆ†åˆ«æ˜¯è¡¨ç¤ºæ–‡ç« æ•°æ®çš„çŸ©é˜µã€‚</p><p>å½“å¤„ç†çš„æ•°æ®æ˜¯ â€œç”¨ D ç»´è¯å‘é‡è¡¨ç¤ºçš„Nä¸ªè¯çš„æ–‡ç« æ•°æ®â€ æ—¶ï¼ŒQ å’Œ Kæ˜¯ N*Då¤§å°çš„çŸ©é˜µã€‚</p><p>å› æ­¤ï¼Œè¿™ä¸ªè®¡ç®—äº† æŸ¥è¯¢ Q å’Œ è¾“å…¥æ•°æ® K ä¸­çš„ç‚¹ç§¯ã€‚</p><img src="/Attention9.png"><p>å‘é‡ä¹‹é—´çš„ç‚¹ç§¯å¤§æ„å‘³ç€æ–¹å‘æ¥è¿‘ï¼Œå³å‘é‡ä¹‹é—´çš„ç›¸ä¼¼æ€§é«˜ï¼ˆè¯ä¹‹é—´çš„ç›¸ä¼¼æ€§é«˜ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå°†æ–‡ç« æ•°æ®è¾“å…¥åˆ°ScaledDotProductAttention ä¸­ï¼ŒQå’ŒKä¸­çš„è¯ä¹‹é—´çš„ç›¸ä¼¼æ€§å°†ä½œä¸ºè¾“å…¥çš„é‡è¦æ€§è¿›è¡ŒåŠ æƒã€‚</p><p>é€šè¿‡è®¡ç®—ä¸Šé¢å¾—åˆ°çš„æ³¨æ„åŠ›æƒé‡ã€‚è¯¥æƒé‡ å’Œ å€¼Vçš„ä¹˜ç§¯ï¼Œå¯ä»¥å¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºæ³¨æ„åŠ›ç‰¹å¾ã€‚</p><img src="/Attention10.png"><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    2.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.2 ä»£ç å®ç°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScaledDotProductAttention</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # åˆå§‹åŒ–ScaledDotProductAttentionç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªPyTorchæ¨¡å‹æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, d_k: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è°ƒç”¨åŸºç±»çš„åˆå§‹åŒ–æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d_k  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># d_kæ˜¯è¾“å…¥ç‰¹å¾çš„ç»´åº¦ï¼Œç”¨äºè®¡ç®—ç¼©æ”¾å› å­</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> forward</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        self,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        q: torch.Tensor,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥è¯¢ï¼ˆQï¼‰ï¼Œä¸€ä¸ªå¼ é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        k: torch.Tensor,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é”®ï¼ˆKï¼‰ï¼Œä¸€ä¸ªå¼ é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        v: torch.Tensor,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å€¼ï¼ˆVï¼‰ï¼Œä¸€ä¸ªå¼ é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mask: torch.Tensor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ©ç ï¼Œç”¨äºåœ¨è®¡ç®—æ³¨æ„åŠ›æƒé‡æ—¶å¿½ç•¥æŸäº›ä½ç½®ï¼Œé»˜è®¤ä¸ºNone</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) -&gt; torch.Tensor:  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®šä¹‰forwardæ–¹æ³•ï¼Œè¿”å›æ³¨æ„åŠ›æœºåˆ¶çš„è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        scalar </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.sqrt(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_k)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ ¹æ®d_kè®¡ç®—ç¼©æ”¾å› å­</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è®¡ç®—Qå’ŒKçš„ç‚¹ç§¯ï¼Œç„¶åé™¤ä»¥ç¼©æ”¾å› å­ï¼Œå¾—åˆ°æœªå½’ä¸€åŒ–çš„æ³¨æ„åŠ›æƒé‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        attention_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.matmul(q, torch.transpose(k, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scalar </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å¦‚æœæä¾›äº†æ©ç ï¼Œåˆ™åœ¨è®¡ç®—æ³¨æ„åŠ›æƒé‡æ—¶å°†æ©ç ä½ç½®çš„æƒé‡ç½®ä¸ºè´Ÿæ— ç©·</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mask </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mask.dim() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> attention_weight.dim():</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                raise</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ValueError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &quot;æ©ç çš„ç»´åº¦ä¸æ³¨æ„åŠ›æƒé‡çš„ç»´åº¦ä¸åŒ¹é…ï¼Œæ©ç çš„ç»´åº¦=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, æ³¨æ„åŠ›æƒé‡çš„ç»´åº¦=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.format(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        mask.dim(), attention_weight.dim()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            attention_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> attention_weight.data.masked_fill_(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                mask, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">torch.finfo(torch.float).max</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ) </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å¯¹æœªå½’ä¸€åŒ–çš„æ³¨æ„åŠ›æƒé‡åº”ç”¨softmaxå‡½æ•°ï¼Œå¾—åˆ°å½’ä¸€åŒ–çš„æ³¨æ„åŠ›æƒé‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        attention_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.functional.softmax(attention_weight, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è®¡ç®—åŠ æƒçš„å€¼ï¼Œå³ç”¨å½’ä¸€åŒ–çš„æ³¨æ„åŠ›æƒé‡ä¹˜ä»¥Vï¼Œå®Œæˆæ³¨æ„åŠ›æœºåˆ¶çš„è®¡ç®—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.matmul(attention_weight, v)</span></span></code></pre></div><p>å¦‚æœæ©ç çš„ç»´åº¦ä¸ç­‰äºæ³¨æ„åŠ›æƒé‡çš„ç»´åº¦ï¼Œå°†å¼•å‘é”™è¯¯ã€‚</p><p>æ³¨æ„åŠ›æƒé‡é€šè¿‡softmaxå‡½æ•°è®¡ç®—å¾—å‡ºï¼š</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">attention_weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.functional.softmax(attention_weight, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è®¡ç®—æ³¨æ„åŠ›æƒé‡</span></span></code></pre></div><p>æœ€ç»ˆï¼Œé€šè¿‡æ³¨æ„åŠ›æƒé‡å’Œ è¾“å…¥X çš„ä¹˜ç§¯å¾—åˆ°åŠ æƒç»“æœï¼š</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.matmul(attention_weight, v)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é€šè¿‡ (æ³¨æ„åŠ›æƒé‡) * X è¿›è¡ŒåŠ æƒã€‚</span></span></code></pre></div><h2 id="_6-å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶" tabindex="-1">6.å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ <a class="header-anchor" href="#_6-å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶" aria-label="Permalink to &quot;6.å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶&quot;">â€‹</a></h2><h3 id="_6-1-å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶" tabindex="-1">6.1 å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ <a class="header-anchor" href="#_6-1-å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶" aria-label="Permalink to &quot;6.1 å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶&quot;">â€‹</a></h3><p>åœ¨ç¬¬ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬è§£é‡Šäº†Transformeræ¨¡å‹ä½¿ç”¨Scaled Dot-Product Attentionä½œä¸ºå…¶æ³¨æ„åŠ›è®¡ç®—æ–¹æ³•ã€‚</p><p>ç„¶è€Œï¼ŒTransformerä¸­ä½¿ç”¨çš„æ³¨æ„åŠ›ä¸ä»…ä»…æ˜¯ç®€å•çš„Scaled Dot-Product Attentionï¼Œå®é™…ä¸Šï¼ŒTransformeré‡‡ç”¨äº†ä¸€ç§ç§°ä¸ºMultihead Attentionçš„æœºåˆ¶ï¼Œå®ƒå¹¶è¡Œåœ°æ‰§è¡Œå¤šä¸ªScaled Dot-Product Attentionã€‚</p><p>å¤šå¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶é¡¾åæ€ä¹‰å°±æ˜¯å°†å¤šä¸ªâ€œæ³¨æ„åŠ›å¤´â€åº”ç”¨äºåŒä¸€åºåˆ—ã€‚ç¡®åˆ‡çš„è‡ªæ³¨æ„åŠ›æœºåˆ¶ä¼šå¹¶è¡Œåœ°å¯¹åŒä¸€è¾“å…¥åºåˆ—é‡æ–°åº”ç”¨å…«æ¬¡ã€‚å¯¹äºæ¯ä¸ªæ³¨æ„åŠ›å¤´ï¼Œå…¶QæŸ¥è¯¢ã€Ké”®å’ŒVå€¼æƒé‡çŸ©é˜µ éƒ½ä¼šéšæœºåˆå§‹åŒ–ï¼ŒæœŸé—´æ¯ä¸ªæ³¨æ„åŠ›å¤´éƒ½èƒ½ä»è¾“å…¥åºåˆ—ä¸­æ•è·ä¸åŒç±»å‹çš„ä¿¡æ¯ã€‚</p><p>æ¯ä¸ªæ³¨æ„åŠ›å¤´éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå½¢çŠ¶ä¸º (åºåˆ—é•¿åº¦ï¼Œ64) çš„çŸ©é˜µï¼›ç„¶åå®ƒä»¬æ²¿å…¶ç¬¬äºŒç»´è¿æ¥èµ·æ¥ï¼Œåˆ›å»ºä¸€ä¸ªå½¢çŠ¶ä¸º (åºåˆ—é•¿åº¦ï¼Œ8*64) çš„çŸ©é˜µã€‚åœ¨æ­¤çŸ©é˜µä¸Šæ‰§è¡Œçº¿æ€§æŠ•å½±ä»¥â€œç»“åˆâ€æ‰€æœ‰æ³¨æ„åŠ›å¤´çš„çŸ¥è¯†ã€‚ç”¨äºçº¿æ€§æŠ•å½±çš„æƒé‡çŸ©é˜µä¸æ¨¡å‹çš„å…¶ä½™éƒ¨åˆ†ä¸€èµ·é€šè¿‡åå‘ä¼ æ’­è¿›è¡Œè®­ç»ƒã€‚</p><img src="/Attention10.png"><img src="/Attention11.png"><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è®ºæ–‡ä¸­Multihead Attentionçš„ç¤ºæ„å›¾ã€‚</p><div class="flex justify-center"><img src="/Attention12.png"></div><p>åœ¨ Transformer çš„åŸå§‹è®ºæ–‡ä¸­ï¼Œä½œè€…ä½¿ç”¨äº† 8 ä¸ªæ³¨æ„åŠ›å¤´ã€‚ä½†åæ¥çš„ç ”ç©¶è¡¨æ˜ï¼Œè¿™å¯èƒ½æ²¡æœ‰å¿…è¦ã€‚åœ¨è®ºæ–‡ã€Šåˆ†æå¤šå¤´è‡ªæ³¨æ„åŠ›ï¼šä¸“ç”¨æ³¨æ„åŠ›å¤´æ‰¿æ‹…é‡ä»»ï¼Œå…¶ä½™éƒ¨åˆ†å¯ä»¥ä¿®å‰ªã€‹ä¸­ï¼ŒElena Voita ç­‰äººæå‡ºï¼Œåœ¨ 8 ä¸ªæ³¨æ„åŠ›å¤´ä¸­ï¼Œæœ‰ä¸‰ä¸ªâ€œä¸“ç”¨â€æ³¨æ„åŠ›å¤´æ‰¿æ‹…äº†å¤§éƒ¨åˆ†å·¥ä½œã€‚å…·ä½“æ¥è¯´ï¼Œè¿™äº›ä¸“ç”¨æ³¨æ„åŠ›å¤´çš„ä½œç”¨è¢«å‡è®¾å¦‚ä¸‹ï¼š</p><p>å›¾ä¸­çš„ h(å¤´æ•°) è¡¨ç¤ºå¹¶è¡Œè¿è¡Œçš„ ScaledDotProductAttention çš„æ•°é‡ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.2 ä»£ç å®ç°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> layers.transformer.ScaledDotProductAttention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ScaledDotProductAttention</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MultiHeadAttention</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, d_model: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, h: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d_model</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d_model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">//</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_v </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d_model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">//</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> h</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å®šä¹‰å‚æ•°çŸ©é˜µ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.W_k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.Parameter(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            torch.Tensor(h, d_model, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_k)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤´æ•°, è¾“å…¥ç»´åº¦, è¾“å‡ºç»´åº¦(=è¾“å…¥ç»´åº¦/å¤´æ•°)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.W_q </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.Parameter(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            torch.Tensor(h, d_model, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_k)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤´æ•°, è¾“å…¥ç»´åº¦, è¾“å‡ºç»´åº¦(=è¾“å…¥ç»´åº¦/å¤´æ•°)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.W_v </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.Parameter(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            torch.Tensor(h, d_model, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_v)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤´æ•°, è¾“å…¥ç»´åº¦, è¾“å‡ºç»´åº¦(=è¾“å…¥ç»´åº¦/å¤´æ•°)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.scaled_dot_product_attention </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ScaledDotProductAttention(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_k)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.linear </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nn.Linear(h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_v, d_model)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> forward</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        self,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        q: torch.Tensor,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        k: torch.Tensor,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        v: torch.Tensor,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mask_3d: torch.Tensor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) -&gt; torch.Tensor:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        batch_size, seq_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> q.size(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), q.size(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æŒ‰å¤´æ•°é‡å¤Query, Key, Value</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        q </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> q.repeat(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.h, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># head, batch_size, seq_len, d_model</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> k.repeat(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.h, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># head, batch_size, seq_len, d_model</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        v </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v.repeat(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.h, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># head, batch_size, seq_len, d_model</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åœ¨ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ä¹‹å‰è¿›è¡Œçº¿æ€§å˜æ¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        q </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.einsum(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;hijk,hkl-&gt;hijl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (q, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.W_q)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># head, batch_size, d_k, seq_len</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.einsum(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;hijk,hkl-&gt;hijl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (k, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.W_k)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># head, batch_size, d_k, seq_len</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        v </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.einsum(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;hijk,hkl-&gt;hijl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (v, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.W_v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># head, batch_size, d_k, seq_len</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆ†å‰²å¤´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        q </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> q.view(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> batch_size, seq_len, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_k)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> k.view(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> batch_size, seq_len, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_k)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        v </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v.view(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.h </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> batch_size, seq_len, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.d_v)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mask_3d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            mask_3d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mask_3d.repeat(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.h, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        attention_output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.scaled_dot_product_attention(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            q, k, v, mask_3d</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (head*batch_size, seq_len, d_model)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        attention_output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.chunk(attention_output, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.h, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        attention_output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.cat(attention_output, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åœ¨ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ä¹‹åè¿›è¡Œçº¿æ€§å˜æ¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.linear(attention_output)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-d97ed5b1 data-v-a4e6cfb0><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-a4e6cfb0><span class="visually-hidden" id="doc-footer-aria-label" data-v-a4e6cfb0>Pager</span><div class="pager" data-v-a4e6cfb0><!----></div><div class="pager" data-v-a4e6cfb0><a class="VPLink link pager-link next" href="/documents/artificial/CNN/Yolov5%E8%87%AA%E6%88%91%E8%A7%A3%E6%9E%90.html" data-v-a4e6cfb0><!--[--><span class="desc" data-v-a4e6cfb0>ä¸‹ä¸€é¡µ</span><span class="title" data-v-a4e6cfb0>Yolov5è‡ªæˆ‘è§£æ</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"DWUo9Dnx\",\"documents_about_me_æˆ‘çš„ç®€å†.md\":\"CQ3X6RaZ\",\"documents_artificial_cnn_yolov5è‡ªæˆ‘è§£æ.md\":\"DbeLx6fb\",\"documents_artificial_nlp_transformer.md\":\"txWInAT4\",\"documents_font_end_ccidè‡ªåŠ¨åŒ–éƒ¨ç½².md\":\"BQJUbC0w\",\"documents_font_end_piniaæ‰‹å†™æºç .md\":\"v17U8vDA\",\"documents_font_end_webpackæ‰“åŒ…æºç .md\":\"BPFxjWOX\",\"documents_font_end_åŸ‹ç‚¹ç›‘æ§.md\":\"rF7ZkOwC\",\"index.md\":\"CPR-HvKp\",\"markdown-examples.md\":\"C82o6113\",\"readme.md\":\"DeFCzp3a\",\"readme1.md\":\"Cruorsvk\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"maomaoliao\",\"description\":\"æˆ‘è‡ªå·±çš„åšå®¢\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":\"dark\",\"themeConfig\":{\"logo\":\"/cat.png\",\"nav\":[{\"text\":\"ğŸ¡ä¸»é¡µ\",\"link\":\"/\"},{\"text\":\"ğŸ”–å‰ç«¯æŠ€æœ¯\",\"items\":[{\"text\":\"ğŸ–¥ï¸ åŸ‹ç‚¹ç›‘æ§\",\"link\":\"/documents/font_end/åŸ‹ç‚¹ç›‘æ§\"},{\"text\":\"ğŸ”¥ webpackæ‰“åŒ…æºç \",\"link\":\"/documents/font_end/webpackæ‰“åŒ…æºç \"},{\"text\":\"ğŸ“ˆ ccidè‡ªåŠ¨åŒ–éƒ¨ç½²\",\"link\":\"/documents/font_end/ccidè‡ªåŠ¨åŒ–éƒ¨ç½²\"},{\"text\":\"ğŸ‘Œ piniaæ‰‹å†™æºç \",\"link\":\"/documents/font_end/piniaæ‰‹å†™æºç \"}]},{\"text\":\"ğŸ”¥AIæŠ€æœ¯\",\"items\":[{\"text\":\"ğŸ”¥NLP\",\"link\":\"/documents/artificial/NLP/Transformer\"},{\"items\":[{\"text\":\"ğŸ¤– Transformer\",\"link\":\"/documents/artificial/NLP/Transformer\"}]},{\"text\":\"ğŸ”¥CNN\",\"link\":\"/documents/artificial/CNN/Yolov5è‡ªæˆ‘è§£æ\"},{\"items\":[{\"text\":\"ğŸŒ± Yolov5è‡ªæˆ‘è§£æ\",\"link\":\"/documents/artificial/CNN/Yolov5è‡ªæˆ‘è§£æ\"}]}]}],\"sidebar\":{\"/documents/about_me/\":[{\"text\":\"ä¸ªäººèµ„æ–™\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"æˆ‘çš„ç®€å†\",\"link\":\"/documents/about_me/æˆ‘çš„ç®€å†\"}]}],\"/documents/artificial/\":[{\"text\":\"NLP\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Transformer\",\"link\":\"/documents/artificial/NLP/Transformer\"}]},{\"text\":\"CNN\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"Yolov5è‡ªæˆ‘è§£æ\",\"link\":\"/documents/artificial/CNN/Yolov5è‡ªæˆ‘è§£æ\"}]}],\"/documents/font_end\":[{\"text\":\"å‰ç«¯æŠ€æœ¯\",\"collapsible\":true,\"collapsed\":true,\"items\":[{\"text\":\"ccidè‡ªåŠ¨åŒ–éƒ¨ç½²\",\"link\":\"/documents/font_end/ccidè‡ªåŠ¨åŒ–éƒ¨ç½²\"},{\"text\":\"piniaæ‰‹å†™æºç \",\"link\":\"/documents/font_end/piniaæ‰‹å†™æºç \"},{\"text\":\"webpackæ‰“åŒ…æºç \",\"link\":\"/documents/font_end/webpackæ‰“åŒ…æºç \"},{\"text\":\"åŸ‹ç‚¹ç›‘æ§\",\"link\":\"/documents/font_end/åŸ‹ç‚¹ç›‘æ§\"}]}]},\"docFooter\":{\"prev\":\"ä¸Šä¸€é¡µ\",\"next\":\"ä¸‹ä¸€é¡µ\"},\"lastUpdated\":{\"text\":\"æœ€åæ›´æ”¹æ—¶é—´\",\"formatOptions\":{\"dateStyle\":\"full\",\"timeStyle\":\"short\"}},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>